(function(){ /*
 Copyright 2010 Google Inc.  All Rights Reserved.
 Your use of this software is subject to the Terms of Service located
 at https://chrome.google.com/extensions/intl/en/gallery_tos.html.
*/
var idcs_;var idcs_a=function(a,b,c){return a.call.apply(a.bind,arguments)},idcs_b=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},idcs_c=function(a,b,c){idcs_c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?idcs_a:idcs_b;return idcs_c.apply(null,arguments)};var idcs_d=function(a,b){this.buffer_=[];for(var c=this.tail_=this.head_=0;c<b+1;c++)this.buffer_.push({character:"",node:null,offset:0});this.read_=-1;this.iterator_=a};idcs_=idcs_d.prototype;idcs_.next=function(){this.read_=(this.read_+1)%this.buffer_.length;if(this.read_!=this.tail_)return!0;var a=this.iterator_.next();if(a){var b=this.buffer_[this.tail_];b.character=this.iterator_.character();b.offset=this.iterator_.offset();b.node=this.iterator_.node();this.tail_=(this.tail_+1)%this.buffer_.length}return a};
idcs_.character=function(){return this.buffer_[this.read_].character};idcs_.node=function(){return this.buffer_[this.read_].node};idcs_.offset=function(){return this.buffer_[this.read_].offset};idcs_.count=function(){return this.iterator_.count()};var idcs_e=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/(?:advanced_)?search.*(([?&]q=)([^&]+))/,idcs_f=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/(?:webhp[^#]*)?(#((?:.+&)?q=)([^&]+)(.*)&fp=[^&]+)/,idcs_g=/&/g,idcs_h=/</g,idcs_i=/>/g,idcs_j=/\"/g;function idcs_k(a){return a?a.replace(idcs_g,"&amp;").replace(idcs_h,"&lt;").replace(idcs_i,"&gt;").replace(idcs_j,"&quot;"):""}
function idcs_l(a){var b;b=document.createTreeWalker(a,window.NodeFilter.SHOW_TEXT,null,!1);for(a=[];b.nextNode();)a.push(b.currentNode);for(b=0;b<a.length;b++){var c=a[b],d=c.data.match(idcs_m);if(d){for(var e=c.parentNode,f=0;f<d.length;f++){var g=d[f];if(2>g.length||20<g.length||idcs_n(g.charAt(0)))e.insertBefore(document.createTextNode(g),c);else{var h=jQuery('<span class="goog_qs-nowrap"/>').get(0);h.appendChild(document.createTextNode(g.charAt(0)));h.appendChild(document.createElement("img"));
h.appendChild(document.createTextNode(g.substring(1)));e.insertBefore(h,c)}}e.removeChild(c)}}}var idcs_m=/\s+|\S+/g,idcs_o=String.fromCharCode(160);function idcs_n(a){a=a.charCodeAt(0);return 97<=a?122>=a?!1:128<=a?!1:!0:65<=a?90>=a?!1:!0:48<=a&&57>=a?!1:!0}function idcs_p(a,b,c,d,e,f,g,h){return idcs_c.apply(null,arguments)};var idcs_q=function(a,b){this.iterator_=a;this.filterFn_=b;this.character_=null;this.returnedWhitespace_=!0;this.lastNode_=null};idcs_=idcs_q.prototype;
idcs_.next=function(){for(;this.iterator_.next();){if(this.node()!=this.lastNode_){for(;idcs_r(this,this.node());)if(!this.iterator_.nextNode())return!1;this.lastNode_=this.node()}var a=this.iterator_.character(),b=" "==a||"\n"==a||a==idcs_o||"\r"==a||"\t"==a;if(!this.returnedWhitespace_||!b)return this.character_=(this.returnedWhitespace_=b)?" ":"\u2018"==a||"\u2019"==a?"'":a,!0}return!1};idcs_.character=function(){return this.character_};idcs_.node=function(){return this.iterator_.node()};
idcs_.offset=function(){return this.iterator_.offset()};idcs_.count=function(){return this.iterator_.count()};var idcs_s=function(a,b){return b.style&&"none"==b.style.display||b.parentNode&&idcs_s(a,b.parentNode)?!0:!1},idcs_r=function(a,b){return idcs_s(a,b.parentNode)||a.filterFn_&&a.filterFn_(b)};var idcs_t=function(a){this.htmlTidbit_=a};var idcs_u=function(a,b,c){this.searchUrl=a;this.query=b;this.ei=c;this.tidbits=[];this.htmlTidbits=[];this.hasEbmTidbits=!0;this.href=null;this.seen=this.minimized=!1;this.debug=null;this.fromVisualSnippet=!1;this.vsClickedTidbitIndex=-1};idcs_u.prototype.addTidbit=function(a,b){this.tidbits.push(a);this.htmlTidbits.push(b)};idcs_u.prototype.toString=function(){return"{"+this.href+" ["+this.tidbits.length+" tidbits]}"};var idcs_v=function(a){return(a=a.match(idcs_e)||a.match(idcs_f))?decodeURIComponent(a[3].replace(/\+/g," ")):null};var idcs_y=function(a,b,c){var d=jQuery(a).find("#res");if(0==d.length)return[];var e=idcs_w(a,b),f=[];d.find(".g").each(function(a,d){f.push(idcs_x(d,b,e,c))});return f},idcs_w=function(a,b){var c=jQuery(a).find("#sflas").get(0);return c?idcs_v(c.href):idcs_v(b)},idcs_x=function(a,b,c,d){b=new idcs_u(b,c,d);c=jQuery(a).find("h3.r > a");if(0<c.length){d=c.get(0).href;var e=d.match(idcs_z)||d.match(idcs_A);b.href=e?decodeURIComponent(e[1]):d;c=c.get(0);c.getAttribute("onmousedown")&&c.getAttribute("onmousedown").match(idcs_B)||
c.href.match(idcs_C)}idcs_D(a,b);return b},idcs_z=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/url.*[?&]url=([^&]+)/,idcs_A=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/url.*[?&]q=([^&]+)/,idcs_B=/clk\(this.href,'.*','.*','.*','.*','.*','([^']+)'\)/,idcs_C=/https?:\/\/(?:.+\.)?google\.[a-z]{2,3}(?:\.[a-z]{2})?(?:\:[0-9]+)?\/url\?(?:q|url)=.+&ved=([^&]+)/,idcs_D=function(a,b){var c=jQuery(a).find(".s").first().find(".ft");0==c.length&&(b.hasEbmTidbits=
!1,c=jQuery(a).find(".s").first().find(".nft"));c.each(function(a,c){var f;f=c.textContent.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").replace(/\s+/g," ");var g=c.innerHTML;5<=f.length&&(0<b.tidbits.length||!(13>=f.length&&/\d{4}/.test(f)))&&b.addTidbit(f,g)})};var idcs_E=function(a,b,c){this.walker_=b.createTreeWalker(c,a.NodeFilter.SHOW_TEXT||4,null,!1);this.currentNode_=null;this.nodeOffset_=-1;this.charCount_=0};idcs_=idcs_E.prototype;idcs_.next=function(){return this.currentNode_&&++this.nodeOffset_<this.currentNode_.length?(this.charCount_++,!0):this.nextNode()};
idcs_.nextNode=function(){for(;this.walker_.nextNode();)if(this.currentNode_=this.walker_.currentNode,0<this.currentNode_.length)return this.nodeOffset_=0,this.charCount_++,!0;this.currentNode_=null;return!1};idcs_.character=function(){return null==this.currentNode_?null:this.currentNode_.data.charAt(this.nodeOffset_)};idcs_.node=function(){return this.currentNode_};idcs_.offset=function(){return this.nodeOffset_};idcs_.count=function(){return this.charCount_};var idcs_F=function(a,b,c,d){this.win_=a;this.document_=b;this.doneCallback_=c;this.tidbitIndexStart_=d||0;this.htmlTidbits_=this.tidbits_=null;this.matchedTidbits_=[];this.startTime_=(new Date).getTime();this.pauseAtCharCount_=3E5};idcs_F.prototype.showTidbitsOnPage=function(a){this.tidbits_=a.tidbits;this.htmlTidbits_=a.htmlTidbits;this.result_=a;0==this.tidbits_.length?this.doneCallback_(a,[]):idcs_G(this,0)};
var idcs_G=function(a,b){idcs_H(a,a.document_.body,a.tidbits_[b],idcs_p(a.foundFragments_,a,b))},idcs_H=function(a,b,c,d){var e=c.length+5+250,f;a.tidbitIndexStart_&&(f=function(a){return-1!=a.parentNode.className.indexOf("goog_qs")});b=new idcs_d(new idcs_q(new idcs_E(a.win_,a.document_,b),f),e);a.findMatchingNodesInternal_(c,b,0,[],[],d)};
idcs_F.prototype.findMatchingNodesInternal_=function(a,b,c,d,e,f){for(;b.next()&&c<a.length;){for(var g=b.character();a.charAt(c)!=g&&idcs_n(a.charAt(c))&&c<a.length-1;)++c;if(5<c){if(a.charAt(c)!=g&&"("==g)a:{for(var g=b,h=1,k=0;g.next();){var n=g.character();if(250<=++k){g=n;break a}if("("==n)++h;else if(")"==n&&(--h,0==h)){if(g.next()){g=g.character();break a}break}}g=null}for(h=0;a.charAt(c)!=g&&5>h&&b.next();)g=b.character(),h++}if(a.charAt(c)!=g)this.tidbitIndexStart_?c=!1:(c=idcs_I(d),c=15>
c?!1:c>idcs_I(e)),c&&(e=d.slice()),c=b,c.read_=c.head_,c.head_=(c.head_+1)%c.buffer_.length,c=d.length=0;else{0<d.length&&d[d.length-1].node==b.node()?d[d.length-1].stop=b.offset():d.push(new idcs_J(b.node(),b.offset(),b.offset()));if(c==a.length-1){f(idcs_K(d));return}++c}if(b.count()>=this.pauseAtCharCount_){if(5E3<(new Date).getTime()-this.startTime_){f(null);return}b.count();this.pauseAtCharCount_+=3E5;this.win_.setTimeout(idcs_p(this.findMatchingNodesInternal_,this,a,b,c,d,e,f),150);return}}f(0<
e.length?idcs_K(e):null)};var idcs_K=function(a){for(var b=[],c=0;c<a.length;c++)" "!=idcs_L(a[c]).replace(/\s+/g," ")&&b.push(a[c]);return b},idcs_I=function(a){for(var b=0,c=0;c<a.length;++c)b+=a[c].stop-a[c].start+1;return b};
idcs_F.prototype.foundFragments_=function(a,b){if(null!=b){for(var c=this.document_,d=this.matchedTidbits_.length,e=Array(b.length),f=0;f<b.length;++f){var g=f,h=c,k=b[f],n=d,m=k.node,p=m.parentNode;if(0<k.start){var l=m.data.slice(0,k.start);p.insertBefore(h.createTextNode(l),m)}k.stop<m.data.length-1&&(l=m.data.slice(k.stop+1),m.parentNode.insertBefore(h.createTextNode(l),m.nextSibling));l=h.createElement("span");jQuery(l).addClass("goog_qs-tidbit goog_qs-tidbit-"+(n+this.tidbitIndexStart_));this.tidbitIndexStart_&&
jQuery(l).addClass("goog_qs-tidbit-added");k=idcs_L(k);l.appendChild(h.createTextNode(k));p.replaceChild(l,m);e[g]=l}this.matchedTidbits_.push(new idcs_t(this.htmlTidbits_[a]))}c=(new Date).getTime()-this.startTime_;a<this.tidbits_.length-1&&5E3>c?idcs_G(this,a+1):this.doneCallback_(this.result_,this.matchedTidbits_)};var idcs_J=function(a,b,c){this.node=a;this.start=b;this.stop=c},idcs_L=function(a){return a.node.data.slice(a.start,a.stop+1)};window.Findy_TidbitHighlighter=idcs_F;
idcs_F.prototype.showTidbitsOnPage=idcs_F.prototype.showTidbitsOnPage;function idcs_M(a,b,c){var d=chrome.extension.connect({name:"log-event"});a={result:a,action:b};c&&(a.params=c);d.postMessage(a)}function idcs_N(){var a=chrome.extension.getURL("about.html");chrome.extension.connect({name:"open-link"}).postMessage({url:a})}
function idcs_O(a){a=jQuery(a);var b=a.get(0);if(!b||!b.parentNode)return!1;var c=a.offset().top-20;jQuery("body").stop();jQuery("body").animate({scrollTop:c},"normal","swing",function(){document.body.scrollTop!=c&&b.scrollIntoView()});return!0}function idcs_P(a){return"url("+chrome.extension.getURL("images/"+a)+")"}
function idcs_Q(a,b,c){a.css("background-image",idcs_P(b));a.mouseover(function(){jQuery("body").hasClass("goog_qs-closed")||jQuery(this).css("background-image",idcs_P(c))});a.mouseout(function(){jQuery("body").hasClass("goog_qs-closed")||jQuery(this).css("background-image",idcs_P(b))})};var idcs_R=function(a,b,c){this.foundTidbits_=b;this.addedTidbitCount_=0;this.result_=a;var d=jQuery('<div id="goog_qs-box-help" />');idcs_Q(d,"help.png","help_on.png");d.attr("title",chrome.i18n.getMessage("qs_tidbit_box_help_tooltip"));d.click(function(){idcs_N()});var e=jQuery('<div id="goog_qs-box-toggle" />');idcs_Q(e,"minimize.png","minimize_on.png");e.attr("title",chrome.i18n.getMessage("qs_tidbit_box_minimize_tooltip"));e.click(idcs_p(this.toggleGQS,this));var f=jQuery('<div id="goog_qs-box-info" />');
f.html(chrome.i18n.getMessage("qs_tidbit_box_matches"));f.css("backgroundImage",idcs_P("icon16x16.png"));f.find(".goog_qs-query").text(a.query||"");this.tidbitsDiv_=jQuery('<div id="goog_qs-box-tidbits" />');if(b)for(var g=0;g<b.length;g++)this.addTidbit(b[g]);b=jQuery('<div id="goog_qs-wrapper" />');b.append(e);b.append(d);b.append(f);a.hasEbmTidbits||(d=jQuery('<div id="goog_qs-box-msg" />'),d.html(chrome.i18n.getMessage("qs_info_non_ebm_result",idcs_k(a.query))),d.find(".goog_qs-learn-more").click(function(){idcs_N()}),
b.append(d));b.append(this.tidbitsDiv_);d=jQuery('<div id="goog_qs-box-bottom"/>');a.hasEbmTidbits&&(d.append(jQuery('<div class="goog_qs-more-matches" id="goog_qs-box-more-tidbits">'+chrome.i18n.getMessage("qs_more_matches")+'</div><div class="goog_qs-more-matches" id="goog_qs-box-fewer-tidbits"      style="display:none">'+chrome.i18n.getMessage("qs_fewer_matches")+"</div>")),d.find("#goog_qs-box-more-tidbits").click(idcs_p(this.moreTidbits_,this)),d.find("#goog_qs-box-fewer-tidbits").click(idcs_p(this.fewerTidbits_,
this)));0<d.children().length&&(b.append(d),b.append('<div style="clear:both" />'));d=jQuery('<div id="goog_qs_tidbit_box" />');d.addClass("notranslate");a.seen||d.addClass("goog_qs-slideup");d.append(b);c||idcs_l(d.get(0));this.div_=d};idcs_=idcs_R.prototype;
idcs_.addTidbit=function(a,b){var c=jQuery('<div class="goog_qs-box-tidbit" />');a.div=c;b?(c.addClass("goog_qs-box-tidbit-added"),a.prev?c.insertAfter(a.prev.div):this.tidbitsDiv_.prepend(c)):this.tidbitsDiv_.append(c);var d=a.htmlTidbit_,d=d.replace(/([^\.])$/,"$1...");c.html(d+' <span class="goog_qs-go">&#187;</span>');c.attr("title",chrome.i18n.getMessage("qs_tidbit_box_tidbit_tooltip"));d=idcs_p(this.goToTidbit,this,a,this.addedTidbitCount_,c,b);c.click(d);this.result_&&this.result_.fromVisualSnippet&&
this.result_.vsClickedTidbitIndex==this.addedTidbitCount_&&window.setTimeout(d,0);this.addedTidbitCount_++;return c.get(0)};idcs_.get=function(){return this.div_};
idcs_.toggleGQS=function(){jQuery("body").toggleClass("goog_qs-closed");jQuery("#goog_qs_tidbit_box").removeClass("goog_qs-slideup");var a=jQuery("body").hasClass("goog_qs-closed"),b=a?chrome.i18n.getMessage("qs_tidbit_box_restore_tooltip"):chrome.i18n.getMessage("qs_tidbit_box_minimize_tooltip"),c=a?"closed":"opened";jQuery("#goog_qs-box-toggle").attr("title",b);b="";b=a?"icon16x16.png":"minimize.png";jQuery("#goog_qs-box-toggle").css("backgroundImage",idcs_P(b));a?(jQuery(".goog_qs-tidbit-hilite").removeClass("goog_qs-tidbit-hilite"),
jQuery(".goog_qs-box-tidbit-selected").removeClass("goog_qs-box-tidbit-selected")):jQuery("#goog_qs_tidbit_box").show();chrome.extension.connect({name:"minimized-state"}).postMessage({result:this.result_,minimized:a});"none"!=jQuery("#goog_qs_tidbit_box").css("display")&&idcs_M(this.result_,c,{ebm:this.result_.hasEbmTidbits})};
idcs_.goToTidbit=function(a,b,c,d){jQuery(".goog_qs-tidbit-hilite").removeClass("goog_qs-tidbit-hilite");a=".goog_qs-tidbit-"+b;idcs_O(a)||(a="body "+a,idcs_O(a));jQuery(a).addClass("goog_qs-tidbit-hilite");jQuery(".goog_qs-box-tidbit-selected").removeClass("goog_qs-box-tidbit-selected");c.addClass("goog_qs-box-tidbit-selected");b={index:b};d&&(b["more-tidbit"]=!0);idcs_M(this.result_,"go-to-tidbit",b)};
idcs_.moreTidbits_=function(){0<jQuery(".goog_qs-box-tidbit-added").length?(jQuery("body").removeClass("goog_qs-hide-added"),jQuery(".goog_qs-box-tidbit-added").show(),jQuery("#goog_qs-box-more-tidbits").hide(),jQuery("#goog_qs-box-fewer-tidbits").show()):(jQuery("#goog_qs_tidbit_box").addClass("goog_qs-wait"),idcs_S(this,function(){jQuery("#goog_qs_tidbit_box").removeClass("goog_qs-wait");jQuery("#goog_qs-box-more-tidbits").hide();jQuery("#goog_qs-box-fewer-tidbits").show()}));idcs_M(this.result_,
"more-tidbits")};idcs_.fewerTidbits_=function(){jQuery("body").addClass("goog_qs-hide-added");jQuery(".goog_qs-box-tidbit-added").hide();jQuery("#goog_qs-box-more-tidbits").show();jQuery("#goog_qs-box-fewer-tidbits").hide();idcs_M(this.result_,"less-tidbits")};
var idcs_S=function(a,b){var c=a.result_,d=c.searchUrl,e=encodeURIComponent("info:"+c.href+" "+c.query),c=d.match(idcs_e),d=(c?d.replace(c[1],c[2]+e):(c=d.match(idcs_f))?d.replace(c[1],"search?"+c[2]+e+c[4]):d)+"&num=1",d=d+"&qscrl=3",c=chrome.extension.connect({name:"get-more-tidbits"});c.onMessage.addListener(idcs_p(a.processNewTidbits_,a,b));c.postMessage({url:d})};
idcs_R.prototype.processNewTidbits_=function(a,b){try{var c=jQuery(b.content).filter("#main"),d=idcs_y(c.get(0),this.result_.searchUrl,this.result_.ei);1!=d.length||(new idcs_F(window,document,idcs_p(this.onFoundNewTidbits_,this),this.addedTidbitCount_)).showTidbitsOnPage(d[0])}finally{a()}};
idcs_R.prototype.onFoundNewTidbits_=function(a,b){if(0!=b.length){var c=this.foundTidbits_.concat(b),d=-1;jQuery(".goog_qs-tidbit").each(function(){var a=this.className.match(/goog_qs-tidbit-(\d+)/);a&&(a=a[1],a!=d&&(c[a].prev=c[d],d=a))});for(var e=0;e<b.length;e++){var f=this.addTidbit(b[e],!0);idcs_l(f)}}};var idcs_T,idcs_U=window.qs_result;idcs_U&&idcs_U.href==document.location.href&&idcs_V();function idcs_V(){(new idcs_F(window,document,idcs_p(idcs_W,this))).showTidbitsOnPage(idcs_U)}
function idcs_W(a,b){var c=chrome.extension.connect({name:"found-tidbits"}),d={result:a};if(a&&b&&0<b.length){var e=idcs_T=new idcs_R(a,b);jQuery("body").append(e.get());e.get().get(0);a.hasEbmTidbits?a.minimized&&idcs_T.toggleGQS():(jQuery("#goog_qs_tidbit_box").hide(),idcs_T.toggleGQS());d.foundTidbits=!0;d.logParams={num:b.length};a.tidbits.length!=b.length&&(d.logParams.expected=a.tidbits.length)}else d.foundTidbits=!1;c.postMessage(d)}
chrome.extension.onRequest.addListener(function(a){a.toggle&&idcs_T&&idcs_T.toggleGQS()}); })();
